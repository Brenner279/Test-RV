<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Amapá Interativo - Foco Cinema</title>
  
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
  <script src="https://unpkg.com/aframe-troika-text@0.10.0/dist/aframe-troika-text.min.js"></script>
  
  <script>
    const db = {
      'vitoria': {
        nome: 'Vitória do Jari',
        bandeira: './assets/bandeiras/vitoria.png',
        hino: './assets/hinos/vitoria.mp3', 
        conteudos: {
          'Turismo': { 
              itens: [
                  { video: './assets/videos/turismo1.mp4', txt: 'Cachoeira do Jari' },
                  { video: './assets/videos/turismo2.mp4', txt: 'Passeio de Barco' },
                  { video: './assets/videos/turismo3.mp4', txt: 'Trilha na Mata' },
                  { video: './assets/videos/turismo4.mp4', txt: 'Centro Histórico' }
              ]
          }
        }
      },
      'macapa': { 
          nome: 'Macapá', 
          bandeira: './assets/bandeiras/macapa.png', 
          hino: './assets/hinos/macapa.mp3', 
          conteudos: {
            'Turismo': { 
                itens: [
                    { video: './assets/videos/fortaleza.mp4', txt: 'Fortaleza' },
                    { video: './assets/videos/marco.mp4', txt: 'Marco Zero' }
                ]
            }
          }
      }
    };

    let cidadeAtual = '';
    let elementoFocado = null;
    let transformacaoOriginal = {};

    window.onload = () => { gerarMenuCidades(); };

    /* --- LÓGICA DE FOCO (ZOOM) --- */
    function focarVideo(el, videoID) {
        if (elementoFocado) return; // Impede clicar em dois ao mesmo tempo

        elementoFocado = el;
        const videoEl = document.getElementById(videoID);
        
        // Salva posição original para poder voltar depois
        transformacaoOriginal = {
            pos: el.getAttribute('position'),
            rot: el.getAttribute('rotation'),
            sca: el.getAttribute('scale') || "1 1 1"
        };

        // 1. Esconde os outros itens da galeria e o botão voltar
        document.querySelectorAll('.item-galeria').forEach(item => {
            if (item !== el.parentNode) item.setAttribute('visible', 'false');
        });
        document.getElementById('btn-voltar-galeria').setAttribute('visible', 'false');

        // 2. Animação de Zoom para o centro da tela
        el.setAttribute('animation__pos', {
            property: 'position',
            to: '0 1.6 -1.5', // Vem para frente do usuário
            dur: 1000,
            easing: 'easeOutQuad'
        });
        el.setAttribute('animation__rot', {
            property: 'rotation',
            to: '0 0 0',
            dur: 1000
        });
        el.setAttribute('animation__sca', {
            property: 'scale',
            to: '1.5 1.5 1.5', // Aumenta o tamanho
            dur: 1000
        });

        // 3. Inicia o vídeo e mostra controles de fechar
        videoEl.play();
        setTimeout(() => {
            document.getElementById('controles-cinema').setAttribute('visible', 'true');
        }, 1000);
    }

    function fecharCinema() {
        if (!elementoFocado) return;

        const videoID = elementoFocado.getAttribute('data-vid-id');
        document.getElementById(videoID).pause();

        // Volta para a posição original
        elementoFocado.setAttribute('animation__pos', { property: 'position', to: transformacaoOriginal.pos, dur: 800 });
        elementoFocado.setAttribute('animation__rot', { property: 'rotation', to: transformacaoOriginal.rot, dur: 800 });
        elementoFocado.setAttribute('animation__sca', { property: 'scale', to: transformacaoOriginal.sca, dur: 800 });

        document.getElementById('controles-cinema').setAttribute('visible', 'false');

        // Reexibe tudo após a animação
        setTimeout(() => {
            document.querySelectorAll('.item-galeria').forEach(item => item.setAttribute('visible', 'true'));
            document.getElementById('btn-voltar-galeria').setAttribute('visible', 'true');
            elementoFocado = null;
        }, 800);
    }

    /* --- NAVEGAÇÃO BASE --- */
    function gerarMenuCidades() {
      const container = document.getElementById('grade-cidades');
      const chaves = Object.keys(db);
      const posicoes = [{p: '-2 1.8 -3'}, {p: '0 1.8 -3'}, {p: '2 1.8 -3'}];

      chaves.forEach((chave, i) => {
        const el = document.createElement('a-entity');
        el.setAttribute('position', posicoes[i].p);
        el.innerHTML = `
          <a-plane src="${db[chave].bandeira}" width="1.5" height="1" class="clicavel" onclick="selecionarCidade('${chave}')">
            <a-troika-text value="${db[chave].nome}" position="0 -0.7 0.1" width="3"></a-troika-text>
          </a-plane>`;
        container.appendChild(el);
      });
    }

    function montarGaleria(itens) {
        const container = document.getElementById('container-galeria');
        container.innerHTML = '';
        const pos = ['-2.5 1.6 -3', '-0.8 1.6 -3', '0.8 1.6 -3', '2.5 1.6 -3'];

        itens.forEach((item, i) => {
            const vidID = `vid-${i}`;
            document.getElementById(vidID).src = item.video;
            
            const entity = document.createElement('a-entity');
            entity.setAttribute('position', pos[i]);
            entity.className = 'item-galeria';
            entity.innerHTML = `
                <a-plane src="#${vidID}" width="1.5" height="1" class="clicavel" 
                         data-vid-id="${vidID}" onclick="focarVideo(this, '${vidID}')">
                    <a-troika-text value="${item.txt}" position="0 -0.7 0.1" width="2"></a-troika-text>
                </a-plane>`;
            container.appendChild(entity);
        });
    }

    function selecionarCidade(chave) {
      cidadeAtual = chave;
      irPara('grupo-turismo');
      montarGaleria(db[chave].conteudos.Turismo.itens);
    }

    function irPara(id) {
        ['grupo-inicio', 'grupo-cidades', 'grupo-turismo'].forEach(g => {
            document.getElementById(g).setAttribute('visible', 'false');
            document.getElementById(g).querySelectorAll('.clicavel').forEach(c => c.classList.remove('interativo'));
        });
        const dest = document.getElementById(id);
        dest.setAttribute('visible', 'true');
        dest.querySelectorAll('.clicavel').forEach(c => c.classList.add('interativo'));
    }
  </script>
</head>
<body>
  <a-scene>
    <a-assets>
        <video id="vid-0" loop crossorigin="anonymous"></video>
        <video id="vid-1" loop crossorigin="anonymous"></video>
        <video id="vid-2" loop crossorigin="anonymous"></video>
        <video id="vid-3" loop crossorigin="anonymous"></video>
    </a-assets>

    <a-entity environment="preset: forest"></a-entity>

    <a-camera>
        <a-cursor color="yellow"></a-cursor>
        <a-entity id="controles-cinema" visible="false" position="0 -0.5 -1">
            <a-plane class="clicavel" width="0.5" height="0.15" color="#F44336" onclick="fecharCinema()">
                <a-troika-text value="FECHAR VIDEO" width="1" position="0 0 0.01"></a-troika-text>
            </a-plane>
        </a-entity>
    </a-camera>

    <a-entity id="grupo-inicio">
        <a-troika-text value="Amapá Interativo" position="0 3 -3" width="8"></a-troika-text>
        <a-plane class="clicavel" position="0 1.5 -3" width="1" height="0.4" color="#004d40" onclick="irPara('grupo-cidades')">
            <a-troika-text value="ENTRAR" width="4"></a-troika-text>
        </a-plane>
    </a-entity>

    <a-entity id="grupo-cidades" visible="false">
        <a-entity id="grade-cidades"></a-entity>
    </a-entity>

    <a-entity id="grupo-turismo" visible="false">
        <a-entity id="container-galeria"></a-entity>
        <a-plane id="btn-voltar-galeria" class="clicavel" position="0 0.5 -3" width="0.6" height="0.2" color="#444" onclick="irPara('grupo-cidades')">
            <a-troika-text value="VOLTAR" width="2"></a-troika-text>
        </a-plane>
    </a-entity>

  </a-scene>
</body>
</html>
